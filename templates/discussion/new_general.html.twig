{% extends 'base.html.twig' %}

{% block title %}Nouvelle discussion - Forum G√©n√©ral - √Ä la bonne station
{% endblock %}

{% block body %}
	<div
		class="max-w-5xl mx-auto px-4 py-8" data-controller="image-uploader">
		{# Breadcrumb #}
		<div class="mb-6">
			<nav class="flex items-center text-sm text-gray-600">
				<a href="{{ path('app_forum') }}" class="hover:text-blue-600">Forum</a>
				<span class="mx-2">/</span>
				<a href="{{ path('app_forum_general') }}" class="hover:text-blue-600">Forum G√©n√©ral</a>
				<span class="mx-2">/</span>
				<span class="text-gray-900 font-medium">Nouvelle discussion</span>
			</nav>
		</div>

		{# En-t√™te #}
		<div class="bg-white rounded-xl shadow-lg p-8 mb-8">
			<div class="flex items-center space-x-6">
				<div class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 text-white text-5xl">
					üí¨
				</div>
				<div>
					<h1 class="text-4xl font-bold text-gray-900 mb-2">Nouvelle discussion</h1>
					<p class="text-xl text-gray-600">Forum G√©n√©ral - Discussions ouvertes √† tous les sujets</p>
				</div>
			</div>
		</div>

		{# Formulaire #}
		<div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
			<div class="p-8">
				<div x-data="{
					submitOnEnter(event) {
						if (event.key === 'Enter' && !event.shiftKey) {
							event.preventDefault();
							// Synchroniser les fichiers avant soumission
							const imageInput = document.getElementById('image-input');
							if (window.imageFiles && window.imageFiles.length > 0) {
								const dataTransfer = new DataTransfer();
								window.imageFiles.forEach(f => dataTransfer.items.add(f));
								imageInput.files = dataTransfer.files;
							}
							event.target.form.submit();
						}
					}
				}">
					{{ form_start(form, {'attr': {'class': 'space-y-6', 'enctype': 'multipart/form-data'}}) }}

					<div>
						{{ form_row(form.title) }}
					</div>

					<div>
						{{ form_label(form.content) }}
						{{ form_widget(form.content, {
                        'attr': {
                            'x-on:keydown': 'submitOnEnter($event)',
                            'placeholder': '√âcrivez votre message... (Entr√©e pour envoyer, Shift+Entr√©e pour un saut de ligne)'
                        }
                    }) }}
						<p class="text-xs text-gray-500 mt-1">
							üí° Appuyez sur
							<kbd class="px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-mono">Entr√©e</kbd>
							pour cr√©er,
							<kbd class="px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-mono">Shift + Entr√©e</kbd>
							pour un saut de ligne
						</p>
					</div>

					{# Upload d'images avec accumulation #}
					<div class="border-2 border-dashed border-gray-300 rounded-lg p-4"
						data-image-uploader-target="dropzone"
						data-action="drop->image-uploader#handleDrop dragover->image-uploader#dragOver dragleave->image-uploader#dragLeave">
						
						<input type="file" 
							id="reply-image-input"
							name="images[]" 
							multiple 
							accept="image/*"
							class="hidden"
							data-image-uploader-target="input"
							data-action="change->image-uploader#handleFiles">
						
						<label for="reply-image-input" class="cursor-pointer text-center block">
							<span class="text-gray-500">üì∑ Glissez vos images ici ou cliquez pour s√©lectionner</span>
							<span class="text-xs text-gray-400 block mt-1">Max 3 images, 5 Mo chacune</span>
						</label>
						
						<div data-image-uploader-target="previews" class="flex gap-2 mt-3 flex-wrap"></div>
					</div>

					<div class="bg-gradient-to-br from-purple-50 to-purple-100 border-l-4 p-6 rounded-r-xl" style="border-color: #a855f7;">
						<p class="text-purple-900 font-medium">
							üìú En publiant, vous acceptez les
							<a href="{{ path('app_forum_rules') }}" target="_blank" class="underline hover:text-purple-700">r√®gles du forum</a>. 
								        Soyez respectueux et constructif !
						</p>
					</div>

					<div class="flex items-center justify-between pt-6">
						<a href="{{ path('app_forum_general') }}" class="text-gray-600 hover:text-gray-900 font-medium text-lg">
							‚Üê Retour
						</a>
						<button type="submit" class="bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white font-bold py-4 px-10 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl text-lg cursor-pointer">
							Cr√©er la discussion
						</button>
					</div>

					{{ form_end(form) }}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
